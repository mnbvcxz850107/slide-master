<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é†«å­¸åœ‹è€ƒè¤‡ç¿’ç¥å™¨</title>
    <style>
        /* --- 1. æ•´é«”æ’ç‰ˆè¨­å®š (CSS) --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            width: 100%;
            max-width: 600px; /* é›»è…¦ç‰ˆæœ€å¤§å¯¬åº¦ */
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            text-align: center;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        h1 { margin: 0 0 10px 0; color: #333; font-size: 1.5rem; }
        p.subtitle { color: #666; margin-top: 0; font-size: 0.9rem; }

        /* --- 2. é¸å–®å€åŸŸæ¨£å¼ --- */
        #menu-area { display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
        
        .menu-btn {
            background-color: #fff;
            border: 2px solid #007bff;
            color: #007bff;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .menu-btn:hover { background-color: #007bff; color: white; transform: translateY(-2px); }
        .menu-btn:active { transform: translateY(0); }

        /* --- 3. ç­”é¡Œå€åŸŸæ¨£å¼ --- */
        #game-area { display: none; /* é è¨­éš±è— */ }
        
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .btn-home { background: #e2e6ea; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; color: #555; }
        .status-text { font-size: 0.9rem; color: #888; }

        /* é¡Œç›®é¡¯ç¤ºå€ */
        #question-display { 
            min-height: 200px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            margin: 20px 0;
        }

        .q-text { font-size: 1.3rem; font-weight: bold; line-height: 1.5; text-align: left; width: 100%; white-space: pre-wrap; }
        
        .q-img { 
            max-width: 100%; 
            max-height: 400px; 
            border-radius: 8px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); 
            cursor: pointer; /* è®“åœ–ç‰‡çœ‹èµ·ä¾†å¯é»æ“Š (å¦‚æœæœªä¾†æƒ³åšæ”¾å¤§åŠŸèƒ½) */
        }
        
        .q-desc { margin-top: 10px; color: #555; font-size: 1rem; }

        /* è¼¸å…¥èˆ‡æŒ‰éˆ•å€ */
        .input-area { margin-top: 15px; }
        
        input[type="text"] {
            width: 60%;
            padding: 10px;
            font-size: 1.2rem;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 8px;
            outline: none;
            text-transform: uppercase; /* å¼·åˆ¶å¤§å¯« */
        }
        input[type="text"]:focus { border-color: #007bff; }

        .btn-group { margin-top: 15px; display: flex; justify-content: center; gap: 10px; }
        
        .btn { padding: 10px 20px; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer; color: white; font-weight: bold; transition: 0.2s; }
        .btn-submit { background-color: #007bff; }
        .btn-submit:hover { background-color: #0056b3; }
        .btn-dunno { background-color: #ffc107; color: #333; }
        .btn-next { background-color: #28a745; display: none; } /* é è¨­éš±è— */

        /* çµæœå›é¥‹ */
        #feedback { margin-top: 20px; font-size: 1.2rem; font-weight: bold; min-height: 30px; }
        .correct { color: #28a745; }
        .wrong { color: #dc3545; }

    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ©º é†«å­¸åœ‹è€ƒè¤‡ç¿’</h1>
    
    <div id="menu-area">
        <p class="subtitle">è«‹é¸æ“‡è¦ç·´ç¿’çš„ç§‘ç›®ï¼š</p>
        <div id="menu-list">
            </div>
    </div>

    <div id="game-area">
        <div class="nav-bar">
            <button class="btn-home" onclick="goHome()">ğŸ  å›é¸å–®</button>
            <span class="status-text" id="progress-text"></span>
        </div>

        <div id="question-display">
            </div>

        <div class="input-area">
            <input type="text" id="answer-input" placeholder="è¼¸å…¥ç­”æ¡ˆ (A/B/C/D)" autocomplete="off">
            <div class="btn-group">
                <button class="btn btn-submit" id="btn-submit" onclick="checkAnswer()">é€å‡º</button>
                <button class="btn btn-dunno" id="btn-dunno" onclick="showAnswer()">ä¸çŸ¥é“</button>
                <button class="btn btn-next" id="btn-next" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â¡</button>
            </div>
        </div>

        <div id="feedback"></div>
    </div>
</div>

<script>
    // ========================================================
    // âš™ï¸ è¨­å®šå€ï¼šè«‹åœ¨é€™è£¡ä¿®æ”¹ä½ çš„é¡Œåº«æª”æ¡ˆ
    // name: æŒ‰éˆ•ä¸Šé¡¯ç¤ºçš„åå­—
    // file: ä½ çš„ csv æª”å (å¿…é ˆæ”¾åœ¨åŒä¸€å±¤è³‡æ–™å¤¾)
    // ========================================================
    const quizList = [
        { name: "ğŸ’€ å¤§é«”è§£å‰–å­¸ (Anatomy)", file: "åˆ‡ç‰‡.csv" },
        { name: "ğŸ’Š è—¥ç†å­¸ (Pharma)", file: "pharma.csv" },
        { name: "ğŸ¦  å¾®ç”Ÿç‰© (Microbiology)", file: "micro.csv" },
        // å¦‚æœæœ‰æ–°é¡Œåº«ï¼Œè¤‡è£½ä¸Šé¢æ ¼å¼ç¹¼çºŒå¾€ä¸‹åŠ 
    ];
    // ========================================================

    let allQuestions = []; // å­˜æ”¾ç›®å‰è®€å–åˆ°çš„æ‰€æœ‰é¡Œç›®
    let currentQ = null;   // ç›®å‰é€™é¡Œçš„è³‡æ–™
    let currentIndex = 0;  // ç›®å‰é¡Œè™Ÿ

    // 1. åˆå§‹åŒ–ï¼šç¶²é è¼‰å…¥æ™‚å»ºç«‹é¸å–®
    window.onload = function() {
        const menuList = document.getElementById('menu-list');
        
        quizList.forEach(item => {
            const btn = document.createElement('button');
            btn.className = 'menu-btn';
            btn.innerHTML = item.name; // æ”¯æ´ emoji
            btn.onclick = () => loadCSV(item.file);
            menuList.appendChild(btn);
        });
    };

    // 2. è®€å– CSV æª”æ¡ˆ
    async function loadCSV(filename) {
        // åˆ‡æ›ä»‹é¢
        document.getElementById('menu-area').style.display = 'none';
        document.getElementById('game-area').style.display = 'block';
        document.getElementById('question-display').innerHTML = '<p>è¼‰å…¥é¡Œåº«ä¸­...</p>';
        document.querySelector('h1').style.display = 'none'; // éš±è—å¤§æ¨™é¡Œä»¥ç¯€çœç©ºé–“

        try {
            // åŠ ä¸Šæ™‚é–“æˆ³è¨˜ ?t=... é˜²æ­¢ç€è¦½å™¨å¿«å–èˆŠè³‡æ–™
            const response = await fetch(filename + '?t=' + new Date().getTime());
            
            if (!response.ok) throw new Error("æ‰¾ä¸åˆ°æª”æ¡ˆ");
            const text = await response.text();
            
            parseCSV(text);
        } catch (err) {
            alert(`âŒ è®€å–å¤±æ•—ï¼šæ‰¾ä¸åˆ° ${filename}\nè«‹ç¢ºèªæª”æ¡ˆåç¨±æ­£ç¢ºä¸”å·²ä¸Šå‚³ GitHubã€‚`);
            goHome();
        }
    }

    // 3. è§£æ CSV å…§å®¹
    function parseCSV(text) {
        allQuestions = [];
        const lines = text.split('\n');

        lines.forEach(line => {
            // ç°¡å–®è™•ç† CSV: å‡è¨­æ²’æœ‰å¼•è™ŸåŒ…è¦†çš„è¤‡é›œç‹€æ³
            // ç§»é™¤å‰å¾Œç©ºç™½
            line = line.trim(); 
            if (!line) return; // è·³éç©ºè¡Œ

            const parts = line.split(',');
            if (parts.length >= 3) {
                // parts[0]: é¡å‹ (text/image)
                // parts[1]: å…§å®¹ (æ–‡å­—æ•˜è¿° æˆ– åœ–ç‰‡æª”å)
                // parts[2]: ç­”æ¡ˆ
                allQuestions.push({
                    type: parts[0].trim(),
                    content: parts[1].trim(),
                    answer: parts[2].trim()
                });
            }
        });

        if (allQuestions.length === 0) {
            alert("é¡Œåº«æ˜¯ç©ºçš„ï¼");
            goHome();
            return;
        }

        // æ´—ç‰Œ (Shuffle)
        allQuestions.sort(() => Math.random() - 0.5);
        currentIndex = 0;
        nextQuestion();
    }

    // 4. é¡¯ç¤ºä¸‹ä¸€é¡Œ
    function nextQuestion() {
        // å¦‚æœé¡Œç›®åšå®Œäº†ï¼Œé‡æ–°å¾ªç’°
        if (currentIndex >= allQuestions.length) {
            alert("é¡Œç›®å·²åšå®Œï¼Œå°‡é‡æ–°é–‹å§‹ï¼");
            currentIndex = 0;
            allQuestions.sort(() => Math.random() - 0.5);
        }

        currentQ = allQuestions[currentIndex];
        currentIndex++;

        // æ›´æ–°é€²åº¦
        document.getElementById('progress-text').innerText = `é€²åº¦: ${currentIndex} / ${allQuestions.length}`;
        
        // é‡ç½®ä»‹é¢
        document.getElementById('feedback').innerText = '';
        document.getElementById('feedback').className = '';
        
        const input = document.getElementById('answer-input');
        input.value = '';
        input.disabled = false;
        input.focus();

        // æŒ‰éˆ•ç‹€æ…‹é‡ç½®
        document.getElementById('btn-submit').style.display = 'inline-block';
        document.getElementById('btn-dunno').style.display = 'inline-block';
        document.getElementById('btn-next').style.display = 'none';

        // æ¸²æŸ“é¡Œç›®
        renderQuestionContent();
    }

    function renderQuestionContent() {
        const display = document.getElementById('question-display');
        display.innerHTML = '';

        if (currentQ.type === 'text') {
            // æ–‡å­—é¡Œï¼šè™•ç† \n æ›è¡Œ
            const textContent = currentQ.content.replace(/\\n/g, '\n');
            display.innerHTML = `<div class="q-text">${textContent}</div>`;
        } else {
            // åœ–ç‰‡é¡Œï¼šè™•ç†è·¯å¾‘
            // æª¢æŸ¥ content æ˜¯å¦åŒ…å« '|' (å¦‚æœæœ‰æ–‡å­—æ•˜è¿°)
            let imgName = currentQ.content;
            let desc = "";

            if (imgName.includes('|')) {
                const parts = imgName.split('|');
                imgName = parts[0];
                desc = parts[1];
            }

            // âš ï¸ é—œéµï¼šè‡ªå‹•è£œä¸Š images/ è·¯å¾‘
            const imgPath = `images/${imgName}`;

            let html = `<img src="${imgPath}" class="q-img" onerror="this.src=''; this.alt='âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•— (${imgName})'">`;
            if (desc) {
                html += `<div class="q-desc">${desc}</div>`;
            }
            display.innerHTML = html;
        }
    }

    // 5. æª¢æŸ¥ç­”æ¡ˆ
    function checkAnswer() {
        const input = document.getElementById('answer-input');
        const userAns = input.value.trim().toUpperCase();
        const correctAns = currentQ.answer.trim().toUpperCase();
        const feedback = document.getElementById('feedback');

        if (!userAns) return; // æ²’å¡«ä¸å‹•ä½œ

        if (userAns === correctAns) {
            feedback.innerText = `âœ… ç­”å°ï¼ç­”æ¡ˆæ˜¯ ${correctAns}`;
            feedback.className = 'correct';
            endRound(); // ç­”å°ç›´æ¥çµæŸé€™å›åˆ
        } else {
            feedback.innerText = `âŒ éŒ¯èª¤... å†è©¦ä¸€æ¬¡`;
            feedback.className = 'wrong';
            input.value = ''; // æ¸…ç©ºè®“ä½¿ç”¨è€…é‡æ‰“
            input.focus();
        }
    }

    // 6. ä¸çŸ¥é“/çœ‹ç­”æ¡ˆ
    function showAnswer() {
        const feedback = document.getElementById('feedback');
        feedback.innerText = `ğŸ’¡ æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${currentQ.answer}`;
        feedback.className = 'wrong'; // ç”¨ç´…è‰²é¡¯ç¤º
        endRound();
    }

    // 7. å›åˆçµæŸ (é–å®šè¼¸å…¥)
    function endRound() {
        document.getElementById('answer-input').disabled = true;
        document.getElementById('btn-submit').style.display = 'none';
        document.getElementById('btn-dunno').style.display = 'none';
        
        // é¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•ä¸¦èšç„¦
        const nextBtn = document.getElementById('btn-next');
        nextBtn.style.display = 'inline-block';
        nextBtn.focus();
    }

    // 8. å›é¦–é 
    function goHome() {
        document.getElementById('game-area').style.display = 'none';
        document.getElementById('menu-area').style.display = 'flex';
        document.querySelector('h1').style.display = 'block';
    }

    // éµç›¤æ”¯æ´ (Enter é€å‡º)
    document.getElementById('answer-input').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            checkAnswer();
        }
    });

</script>

</body>
</html>
